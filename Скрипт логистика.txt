CREATE DATABASE SmartLogistics;
GO
USE SmartLogistics;
GO

CREATE TABLE Measures (
    MeasureID INT IDENTITY PRIMARY KEY,
    Name NVARCHAR(15)
);

CREATE TABLE Categories (
    CategoryID INT IDENTITY PRIMARY KEY,
    Title NVARCHAR(25)
);

CREATE TABLE ItemStatuses (
    StatusID INT IDENTITY PRIMARY KEY,
    StatusName NVARCHAR(20)
);

CREATE TABLE Items (
    ItemID INT IDENTITY PRIMARY KEY,
    SKU NVARCHAR(30), -- Артикул
    FullTitle NVARCHAR(50),
    CategoryID INT,
    Details NVARCHAR(255),
    MeasureID INT,
    StatusID INT,
    FOREIGN KEY (CategoryID) REFERENCES Categories(CategoryID),
    FOREIGN KEY (MeasureID) REFERENCES Measures(MeasureID),
    FOREIGN KEY (StatusID) REFERENCES ItemStatuses(StatusID)
);

CREATE TABLE ComponentTypes (
    TypeID INT IDENTITY PRIMARY KEY,
    TypeName NVARCHAR(20)
);

CREATE TABLE Components (
    ComponentID INT IDENTITY PRIMARY KEY,
    SerialCode NVARCHAR(10),
    Title NVARCHAR(50),
    TypeID INT,
    MeasureID INT,
    MinBalance DECIMAL(18,2),
    Price DECIMAL(18,2),
    FOREIGN KEY (TypeID) REFERENCES ComponentTypes(TypeID),
    FOREIGN KEY (MeasureID) REFERENCES Measures(MeasureID)
);

CREATE TABLE ProductStructure (
    StructureID INT IDENTITY PRIMARY KEY,
    ItemID INT,
    ComponentID INT,
    Amount DECIMAL(18,2),
    FOREIGN KEY (ItemID) REFERENCES Items(ItemID),
    FOREIGN KEY (ComponentID) REFERENCES Components(ComponentID)
);

CREATE TABLE WorkRoutes (
    RouteID INT IDENTITY PRIMARY KEY,
    ItemID INT,
    RouteName NVARCHAR(30),
    FOREIGN KEY (ItemID) REFERENCES Items(ItemID)
);

CREATE TABLE WorkOperations (
    OperationID INT IDENTITY PRIMARY KEY,
    RouteID INT,
    OpName NVARCHAR(50),
    StepNumber INT,
    TimeLimitMinutes INT,
    FOREIGN KEY (RouteID) REFERENCES WorkRoutes(RouteID)
);

CREATE TABLE Vendors (
    VendorID INT IDENTITY PRIMARY KEY,
    TaxNumber NVARCHAR(20),
    CompanyTitle NVARCHAR(50),
    ContactEmail NVARCHAR(30),
    Rating INT,
    PayConditions NVARCHAR(50)
);

CREATE TABLE StorageTypes (
    StorageTypeID INT IDENTITY PRIMARY KEY,
    TypeName NVARCHAR(20)
);

CREATE TABLE Storages (
    StorageID INT IDENTITY PRIMARY KEY,
    Title NVARCHAR(30),
    StorageTypeID INT,
    FOREIGN KEY (StorageTypeID) REFERENCES StorageTypes(StorageTypeID)
);

CREATE TABLE JobTitles (
    JobTitleID INT IDENTITY PRIMARY KEY,
    Title NVARCHAR(20)
);

CREATE TABLE Departments (
    DeptID INT IDENTITY PRIMARY KEY,
    DeptName NVARCHAR(20)
);

CREATE TABLE SkillLevels (
    LevelID INT IDENTITY PRIMARY KEY,
    LevelName NVARCHAR(20)
);

CREATE TABLE PaymentTypes (
    PaymentTypeID INT IDENTITY PRIMARY KEY,
    TypeName NVARCHAR(20)
);

CREATE TABLE StaffStatuses (
    StatusID INT IDENTITY PRIMARY KEY,
    StatusName NVARCHAR(20)
);

CREATE TABLE Staff (
    StaffID INT IDENTITY PRIMARY KEY,
    Phone NVARCHAR(15),
    Surname NVARCHAR(30),
    FirstName NVARCHAR(30),
    Patronymic NVARCHAR(30),
    JobTitleID INT,
    DeptID INT,
    LevelID INT,
    PaymentTypeID INT,
    StatusID INT,
    FOREIGN KEY (JobTitleID) REFERENCES JobTitles(JobTitleID),
    FOREIGN KEY (DeptID) REFERENCES Departments(DeptID),
    FOREIGN KEY (LevelID) REFERENCES SkillLevels(LevelID),
    FOREIGN KEY (PaymentTypeID) REFERENCES PaymentTypes(PaymentTypeID),
    FOREIGN KEY (StatusID) REFERENCES StaffStatuses(StatusID)
);

CREATE TABLE SupplyStatuses (
    StatusID INT IDENTITY PRIMARY KEY,
    StatusName NVARCHAR(20)
);

CREATE TABLE SupplyOrders (
    OrderID INT IDENTITY PRIMARY KEY,
    VendorID INT,
    StorageID INT, 
    StaffID INT, 
    OrderDate DATE,
    DeliveryDate DATE, 
    StatusID INT,
    FOREIGN KEY (VendorID) REFERENCES Vendors(VendorID),
    FOREIGN KEY (StorageID) REFERENCES Storages(StorageID),
    FOREIGN KEY (StaffID) REFERENCES Staff(StaffID),
    FOREIGN KEY (StatusID) REFERENCES SupplyStatuses(StatusID)
);

CREATE TABLE CurrentInventory (
    InventoryID INT IDENTITY PRIMARY KEY,
    StorageID INT,
    ComponentID INT,
    Quantity DECIMAL(18,2),
    FOREIGN KEY (StorageID) REFERENCES Storages(StorageID),
    FOREIGN KEY (ComponentID) REFERENCES Components(ComponentID)
);

CREATE TABLE AppRoles (
    RoleID INT IDENTITY PRIMARY KEY,
    RoleName NVARCHAR(30)
);

CREATE TABLE AppUsers (
    UserID INT IDENTITY PRIMARY KEY,
    LoginName NVARCHAR(30),
    PasswordKey NVARCHAR(30),
    RoleID INT,
    StaffID INT,
    FOREIGN KEY (RoleID) REFERENCES AppRoles(RoleID),
    FOREIGN KEY (StaffID) REFERENCES Staff(StaffID)
);
GO

INSERT INTO Measures (Name) VALUES ('шт'), ('кг'), ('палл');
INSERT INTO Categories (Title) VALUES ('Мебель'), ('Техника');
INSERT INTO ItemStatuses (StatusName) VALUES ('Доступен');
INSERT INTO AppRoles (RoleName) VALUES ('Admin'), ('User');
INSERT INTO JobTitles (Title) VALUES ('Директор'), ('Мастер');
INSERT INTO Departments (DeptName) VALUES ('Главный офис'), ('Цех 1');
INSERT INTO StaffStatuses (StatusName) VALUES ('В штате');
INSERT INTO SkillLevels (LevelName) VALUES ('Высший');
INSERT INTO PaymentTypes (TypeName) VALUES ('Оклад');

INSERT INTO Staff (Surname, FirstName, JobTitleID, DeptID, StatusID) 
VALUES ('Иванов', 'Иван', 1, 1, 1);

INSERT INTO AppUsers (LoginName, PasswordKey, RoleID, StaffID)
VALUES ('admin', 'admin', 1, 1);

USE SmartLogistics;
GO

CREATE TABLE EquipModels (
    ModelID INT IDENTITY PRIMARY KEY,
    ModelName NVARCHAR(30)
);

CREATE TABLE EquipTypes (
    TypeID INT IDENTITY PRIMARY KEY,
    TypeName NVARCHAR(30)
);

CREATE TABLE EquipStatuses (
    StatusID INT IDENTITY PRIMARY KEY,
    StatusName NVARCHAR(30)
);

CREATE TABLE Equipment (
    EquipmentID INT IDENTITY PRIMARY KEY,
    InventoryNumber NVARCHAR(20),
    ModelID INT,
    TypeID INT,
    CommissionDate DATE,
    StatusID INT,
    MaintenanceSchedule NVARCHAR(100),
    FOREIGN KEY (ModelID) REFERENCES EquipModels(ModelID),
    FOREIGN KEY (TypeID) REFERENCES EquipTypes(TypeID),
    FOREIGN KEY (StatusID) REFERENCES EquipStatuses(StatusID)
);

INSERT INTO EquipModels (ModelName) VALUES ('DMG-100'), ('HP-LaserJet');
INSERT INTO EquipTypes (TypeName) VALUES ('Станок'), ('Оргтехника');
INSERT INTO EquipStatuses (StatusName) VALUES ('Работает'), ('В ремонте');
GO